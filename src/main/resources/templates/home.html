<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Home page</title>
</head>
<body>

<h1>Welcome to my page</h1>

<p>You are so welcome</p>

<!-- ðŸŸ¢ FORMULÃ„R: LÃ¤gg till ny rating -->
<div th:if="${loggedIn}">
    <h2>LÃ¤gg till filmrating</h2>
    <form action="/ratings" method="post">
        <label for="movie">Film:</label>
        <input type="text" id="movie" name="movie" required><br><br>

        <label for="rating">Betyg (0â€“10):</label>
        <input type="number" id="rating" name="rating" min="0" max="10" required><br><br>

        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
        <button type="submit">Spara</button>
    </form>
</div>

<!-- ðŸŸ¢ LISTA: Visa befintliga ratings med radera-knapp -->
<div th:if="${loggedIn}">
    <h2>Dina sparade ratings</h2>
    <ul>
        <li th:each="rating : ${ratings}">
            <span th:text="${rating.movie}"></span>:
            <span th:text="${rating.rating}"></span>/10

            <!-- âœ… Uppdaterad Radera-knapp -->
            <form th:action="@{/ratings/{id}(id=${rating.id})}" method="post" style="display:inline;">
                <input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}" />
                <button type="submit">Radera</button>
            </form>
        </li>
    </ul>
</div>

<p th:if="${loggedIn}">
    Hello, <b th:text="${username}">user</b>!
</p>

<!-- OIDC attributes -->
<div th:if="${loggedIn}">
    <p>Here are all the OIDC properties you can use:</p>
    <pre th:text="${#authentication.getPrincipal()}"></pre>
</div>

<!-- Logout form -->
<form action="/logout" method="post" th:if="${loggedIn}">
    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
    <input type="submit" value="Log out" />
</form>

<!-- Login link -->
<p th:unless="${loggedIn}">
    <a th:href="@{/oauth2/authorization/cognito}"><button>Log in</button></a>
</p>

</body>
</html>
